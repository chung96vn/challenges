<!DOCTYPE html>
<html lang="en">
	<head>
		{% if name %}
			<title>{{ name }} secure service</title>
		{% else %}
			<title>Secure service</title>
		{% endif %}
		<!-- Bootstrap core CSS -->
		<link href="static/bootstrap.min.css" rel="stylesheet">

		<!-- Custom styles for this template -->
		<link href="static/3-col-portfolio.css" rel="stylesheet">
	</head>
	
	<body>
		<!-- Navigation -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
			<div class="container">
				{% if name %}
					<a class="navbar-brand" href="#">{{ name }} secure service</a>
				{% else %}
					<a class="navbar-brand" href="#">Secure service</a>
				{% endif %}
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item">
							{% if level %}
								<a class="nav-link" href="#">Your Level : {{ level }}</a>
							{% else %}
								<a class="nav-link" href="#">Your Level : 0</a>
							{% endif %}
						</li>
					</ul>
				</div>
			</div>
		</nav>
		
		<!-- Page Content -->
		<div class="container">
			<!-- Page Heading -->
			<h1 class="my-4">Guessing Key</h1>
			
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-4 col-sm-6 portfolio-item">
					<div class="card h-100">
						<div class="card-body">
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="key1">
								<label class="form-check-label" for="defaultCheck1">
									<h4 class="card-title">KEY 1</h4>
								</label>
							</div>
							<p class="card-text">Secret Key 1</p>
							<p class="card-text">Up to level 1</p>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-sm-6 portfolio-item">
					<div class="card h-100">
						<div class="card-body">
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="key2">
								<label class="form-check-label" for="defaultCheck2">
									<h4 class="card-title">KEY 2</h4>
								</label>
							</div>
							<p class="card-text">Secret Key 2</p>
							<p class="card-text">Up to level 2</p>
						</div>
					</div>
				</div>
			</div>
			
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-4 col-sm-6 portfolio-item">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text" id="basic-addon1">KEY</span>
						</div>
						<input type="text" id="key" class="form-control" placeholder="Secret Key" aria-label="KEY" aria-describedby="basic-addon1">
					</div>
				</div>
				<div class="col-lg-4 col-sm-6 portfolio-item">
					<button type="button" id="upto" class="btn btn-secondary btn-block">Up Level</button>
				</div>
			</div>
			
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-4 col-sm-6 portfolio-item">
					<span class="input-group-text" id="basic-addon1">GET SOURCE CODE</span>
				</div>
				<div class="col-lg-4 col-sm-6 portfolio-item">
					<form method="get" action="/source">
						<input type="hidden" value="app.py" name="name">
						<button type="submit" id="getsource" class="btn btn-secondary btn-block">Get Source</button>
					</form>
				</div>
			</div>
			
			{% if level == 2 %}
				<div class="row">
					<div class="col-lg-4 col-sm-6 portfolio-item">
						<input type="text" id="payload" class="form-control" placeholder="Payload" aria-label="payload" aria-describedby="basic-addon1">
					</div>
					<div class="col-lg-4 col-sm-6 portfolio-item">
						<button type="submit" id="exploit" class="btn btn-secondary btn-block">Exploit</button>
					</div>
				</div>
			{% endif %}
			
		</div>
		
		
		
		
		<!-- Bootstrap core JavaScript -->
		<script src="static/jquery.min.js"></script>
		<script src="static/bootstrap.bundle.min.js"></script>
		<script>
			$(document).ready(function() {
				$('#upto').click(function() {
					var key = ($('#key').val());
					var type = "";
					if ($('#key1').is(":checked") && $('#key2').is(":checked")) {
						alert("Please check only one key!");
					}
					else{
						if ($('#key1').is(":checked")) {
							type = 'key1'
							$.ajax({
								type: 'POST',
								url :'/upto', 
								data: JSON.stringify({type: type, key: key}),
								contentType: 'application/json',
								success: function(result) {
									alert(result.result);
									location.reload();
								}
							})
						}
						else{
							if ($('#key2').is(":checked")) {
								type = 'key2'
								$.ajax({
									type: 'POST',
									url :'/upto', 
									data: JSON.stringify({type: type, key: key}),
									contentType: 'application/json',
									success: function(result) {
										alert(result.result);
										location.reload();
									}
								})
							}
							else alert("Please choice key affter up level!");
						}
					}
				});
			})
		</script>
		
		{% if level == 2 %}
		<script>
			$(document).ready(function() {
				$('#exploit').click(function() {
					var payload = ($('#payload').val());
					$.ajax({
						type: 'POST',
						url :'/exploit', 
						data: JSON.stringify({payload: payload}),
						contentType: 'application/json',
						success: function(result) {
							alert(result.result);
							location.reload();
						}
					})
				});
			})
		</script>
		{% endif %}
		
	</body>
	
</html>
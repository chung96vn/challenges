FROM ubuntu:latest

MAINTAINER anonymous
RUN apt-get update
RUN apt-get install xinetd -y
RUN apt-get install libc6-dev-i386 -y
RUN apt-get install netcat -y

RUN apt-get install -y python-pip python-dev build-essential

RUN pip install -I subprocess32==3.5.0rc1

RUN pip install flask

RUN chmod 774 /tmp
RUN chmod -R 774 /var/tmp
RUN chmod -R 774 /dev
RUN chmod -R 774 /run
RUN chmod 1733 /tmp /var/tmp /dev/shm

RUN useradd -m unexploitable

COPY ./app /app

RUN chown -R root:root /app
RUN chmod -R 755 /app

COPY ./unexploitable /etc/xinetd.d/unexploitable
COPY ./share/flag /home/unexploitable/flag
COPY ./share/run.sh /home/unexploitable/run.sh
COPY ./share/unexploitable /home/unexploitable/unexploitable

COPY ./init.sh /init.sh

RUN chmod +x /init.sh
RUN chmod +x /home/unexploitable/run.sh

RUN chown -R root:unexploitable /home/unexploitable
RUN chmod -R 755 /home/unexploitable
RUN chmod 640 /home/unexploitable/flag

WORKDIR /app

CMD ["/init.sh"]

EXPOSE 8080
